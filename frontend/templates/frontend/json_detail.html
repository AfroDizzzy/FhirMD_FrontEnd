{% extends "frontend/base.html" %}
{% load static %}
{% block content %}
  <link rel="stylesheet" href="{% static 'frontend/jsonDetailStyle.css' %}" />
  {# Highlight.js CSS for a dark theme #}
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
  <main>
    <section class="content-section">
      <div class="sections-details-page-header fixed-element-top">
        <button type="button" onclick="window.history.back();" class="back-button">
          <i class="back-nav-icon"></i>
        </button>
        <h2 class="sections-details-page-header-text">{{ resource_type }} - {{ DisplayName }}</h2>
        <div class="json-details-heading-div">
          <button id="downloadJson" class="download-button">Download JSON</button>
        </div>
      </div>
      {# The <pre><code> block for highlighted JSON #}
      <pre class="json-display"><code class="language-json">{{ pretty_json }}</code></pre>
    </section>
  </main>
  {# Highlight.js library #}
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  {# Initialize Highlight.js after the content is loaded #}
  <script>
  document.addEventListener('DOMContentLoaded', (event) => {
    hljs.highlightAll();
  });
  </script>
  {# JavaScript for download button #}
  <script>
  document.getElementById('downloadJson').addEventListener('click', function() {
    const jsonData = `{{ pretty_json|escapejs }}`; // Use escapejs to handle quotes correctly
    const blob = new Blob([jsonData], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = '{{ resource_type|slugify }}-{{ item_id }}.json'; // Dynamic filename
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url); // Clean up the URL object
  });
  </script>
{% endblock content %}
